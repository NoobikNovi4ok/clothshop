{% extends 'main/layout.html' %}
{% load static %}
{% block title %}
Каталог
{% endblock %}
{% block content %}
<div class="container">
    <div class="row">
        <div class="col-lg-4 col-md-6 col-sm-12">

{% comment %} <h1>Каталог</h1>

<!-- Форма для фильтрации по категориям (если нужно) -->
<form method="GET">
    <select name="category" onchange="this.form.submit()">
        <option value="0">Все категории</option>
        {% for category in categories %}
            <option value="{{ category.slug }}" {% if category.id|stringformat:"d" == category %}selected{% endif %}>
                {{ category.name }}
            </option>
            {% endfor %}
    </select>
</form>

<ul>
    {% if category %}
        {% if cloths %}
            {% for cloth in cloths %}
                <li>
                    <h2>{{ cloth.name }}</h2>
                    <p>Цена: {{ cloth.price }} руб.</p>
                    <p>В наличии: {{ cloth.stock_quantity }}</p>
                </li>
            {% empty %}
                <li>Товары отсутствуют</li>
            {% endfor %}
        {% else %}
        <li>Товары отсутствуют</li>
        {% endif %}
    {% else %}
        {% for cloth in cloths %}
            <li>
                <h2>{{ cloth.name }}</h2>
                <p>Цена: {{ cloth.price }} руб.</p>
                <p>В наличии: {{ cloth.stock_quantity }}</p>
            </li>
        {% empty %}
            <li>Товары отсутствуют</li>
        {% endfor %}
    {% endif %}
</ul> {% endcomment %}

<h1>Каталог товаров</h1>

    {% comment %} <div>
        <h2>Фильтр по категориям</h2>
        <ul>
            {% for category in categories %}
                <li>
                    <a href="?category={{ category.slug }}&sort={{ selected_sort }}{% if selected_category == category.id %}&selected=true{% endif %}">{{ category.name }}</a>
                </li>
            {% endfor %}
        </ul>
    </div> {% endcomment %}

    <form action="{% url 'catalog' %}" method="get">
        <div class="dropdown mb-1">
            <button class="btn btn-light dropdown-toggle" type="button" id="dropdownMenu1"
                data-bs-toggle="dropdown" aria-haspopup="true" data-bs-auto-close="false" aria-expanded="true">
                Категории товаров
            </button>
            <div class="dropdown-menu" style="padding:0;" aria-labelledby="dropdownMenu1">
                {% for category in categories %}
                    <label class="text-center my-2 mx-2"><img src="{{category.icon.url}}" class="icon_plus" style="padding-right:5px; width:64px;height:64px;" alt="{{category.name}}"><input type="checkbox" name="category" value="{{ category.slug }}" {% if category in select_category %} checked {% endif %}> {{ category.name }}</label><br><hr style="margin:0;">
                {% endfor %}
            </div>
        </div>
        <div class="dropdown mb-1">
            <button class="btn btn-light dropdown-toggle" type="button" id="dropdownMenu1"
                data-bs-toggle="dropdown" aria-haspopup="true" data-bs-auto-close="false" aria-expanded="true">
                Сортировка
            </button>
            <div class="dropdown-menu" style="padding:0;" aria-labelledby="dropdownMenu1">
                <label class="text-center my-2 mx-2"><input type="checkbox" name="sort" value="year" {% if 'year' in request %} checked {% endif %}>По году производства</label><br><hr style="margin:0;">
                <label class="text-center my-2 mx-2"><input type="checkbox" name="sort" value="name" {% if 'name' in request %} checked {% endif %}>По наименованию</label><br><hr style="margin:0;">
                <label class="text-center my-2 mx-2"><input type="checkbox" name="sort" value="price" {% if 'price' in request %} checked {% endif %}>По цене</label><br><hr style="margin:0;">
            </div>
        </div>
        <input type="submit" value="Показать" class="btn btn-outline-dark">
    <form>
    </div>
    {% comment %} <div>
        <h2>Сортировка</h2>
         <ul>
            <li><a href="?sort=newest&category={{ selected_category }}">По новизне</a></li>
            <li><a href="?sort=year&category={{ selected_category }}">По году производства</a></li>
            <li><a href="?sort=name&category={{ selected_category }}">По наименованию</a></li>
            <li><a href="?sort=price&category={{ selected_category }}">По цене</a></li>
        </ul>
    </div> {% endcomment %}
    <div class="col-lg-8 col-md-6 col-sm-12 catalog_tovarov">
        <div class="row justify-content-between">
            {% for cloth in cloths %}
            <div class="card border-2 border-dark text-center" style="padding-left:0; padding-right:0px;">
                <div class="card-body" data-href="product/{{ cloth.slug }}">
                    <a href=product/{{cloth.slug}} style="text-decoration:none;">
                    <img src="{{ cloth.photo.url }}" class="card-img p-3" alt="{{ cloth.name }}">
                    <h3 class="card-title text-dark">{{ cloth.name }}</h3>
                    <p class="card-text text-dark pb-1">Цена: {{ cloth.cost }} ₽</p>
                    <a href=product/{{cloth.slug}} class="btn btn-outline-dark" style="text-decoration:none;">Подробнее</a>
                    </a>
                </div>
            </div>
            </a>
            {% endfor %}
        </div>
    </div>
    </div>
    </div>
    <script>
    document.addEventListener('DOMContentLoaded', function() {
        const cards = document.querySelectorAll('.card-body');
        cards.forEach(card => {
            card.addEventListener('click', function() {
                window.location.href = card.getAttribute('data-href');
            });
        });
    });
</script>
{% endblock %}